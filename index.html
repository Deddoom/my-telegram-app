<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±Ø¨Ø§Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #212121;
            --tg-theme-text-color: #ffffff;
            --tg-theme-hint-color: #aaaaaa;
            --tg-theme-link-color: #8774e1;
            --tg-theme-button-color: #8774e1;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #333333;
        }
        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            -webkit-font-smoothing: antialiased;
            margin: 0;
            padding: 0;
        }
        .app-container { max-width: 600px; margin: 0 auto; padding: 16px; }
        .grid-button { background-color: var(--tg-theme-secondary-bg-color); border-radius: 12px; padding: 12px; text-align: center; cursor: pointer; transition: background-color 0.2s ease; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100px; }
        .page { display: none; }
        .page.active { display: block; }
        .back-button, .submit-button { margin-top: 16px; width: 100%; background-color: var(--tg-theme-button-color); color: var(--tg-theme-button-text-color); padding: 10px 0; border-radius: 8px; border: none; cursor: pointer; font-size: 16px; }
        .form-input, .form-textarea { width: 100%; box-sizing: border-box; padding: 10px; border-radius: 6px; background-color: var(--tg-theme-secondary-bg-color); border: 1px solid var(--tg-theme-hint-color); color: var(--tg-theme-text-color); margin-bottom: 10px; }
        .result-box { margin-top: 16px; padding: 12px; background-color: rgba(0,0,0,0.2); border-radius: 8px; min-height: 50px; white-space: pre-wrap; word-wrap: break-word; line-height: 1.6; }
        .loader { text-align: center; padding: 20px; color: var(--tg-theme-hint-color); }
        .result-image { max-width: 100%; border-radius: 8px; margin-top: 10px; }
        h2 { font-size: 1.25rem; font-weight: bold; margin-bottom: 1rem; }
        p.description { margin-bottom: 1rem; font-size: 0.875rem; color: var(--tg-theme-hint-color); }
    </style>
</head>
<body>
    <div class="app-container">

        <div id="page-main-menu" class="page active">
            <h1 class="text-2xl font-bold text-center mb-6">Ø±Ø¨Ø§Øª Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</h1>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <div class="grid-button" onclick="sendData('ai_chat')"><div class="text-3xl">ğŸ’¬</div><div>Ú†Øª Ø¨Ø§ AI</div></div>
                <div class="grid-button" onclick="showPage('page-remove-bg')"><div class="text-3xl">ğŸ–¼ï¸</div><div>Ø­Ø°Ù Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡</div></div>
                <div class="grid-button" onclick="showPage('page-compare-products')"><div class="text-3xl">ğŸ”</div><div>Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª</div></div>
                <div class="grid-button" onclick="showPage('page-create-article')"><div class="text-3xl">ğŸ“°</div><div>Ø³Ø§Ø®Øª Ù…Ù‚Ø§Ù„Ù‡</div></div>
                <div class="grid-button" onclick="showPage('page-image-info')"><div class="text-3xl">â„¹ï¸</div><div>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ú©Ø³</div></div>
                <div class="grid-button" onclick="showPage('page-enhance-image')"><div class="text-3xl">ğŸŒ„</div><div>Ø§ÙØ²Ø§ÛŒØ´ Ú©ÛŒÙÛŒØª</div></div>
                <div class="grid-button" onclick="showPage('page-ghibli')"><div class="text-3xl">ğŸ‘</div><div>ØªØ¨Ø¯ÛŒÙ„ Ø¹Ú©Ø³</div></div>
                <div class="grid-button" onclick="showPage('page-create-image')"><div class="text-3xl">âœ¨</div><div>Ø³Ø§Ø®Øª Ø¹Ú©Ø³</div></div>
                <div class="grid-button" onclick="showPage('page-translate')"><div class="text-3xl">ğŸŒ</div><div>ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ†</div></div>
                <div class="grid-button" onclick="showPage('page-currency')"><div class="text-3xl">ğŸ’¹</div><div>Ù†Ø±Ø® Ø§Ø±Ø²</div></div>
                <div class="grid-button" onclick="showPage('page-advanced-search')"><div class="text-3xl">ğŸ”</div><div>Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</div></div>
                <div class="grid-button" onclick="showPage('page-help')"><div class="text-3xl">ğŸ’â€â™‚ï¸</div><div>Ø±Ø§Ù‡Ù†Ù…Ø§</div></div>
            </div>
        </div>

        <div id="page-remove-bg" class="page">
            <h2>ğŸ–¼ï¸ Ø­Ø°Ù Ù¾Ø³ Ø²Ù…ÛŒÙ†Ù‡</h2>
            <p class="description">ÙØ§ÛŒÙ„ Ø¹Ú©Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.</p>
            <input type="file" id="remove-bg-input" class="form-input" accept="image/*">
            <button class="submit-button" onclick="handleImageUpload('remove-bg')">Ø§Ø±Ø³Ø§Ù„</button>
            <div id="remove-bg-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>

        <div id="page-compare-products" class="page">
            <h2>ğŸ” Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª</h2>
            <p class="description">Ù†Ø§Ù… Ø¯Ùˆ Ù…Ø­ØµÙˆÙ„ (Ù…Ø«Ù„Ø§ Ø§Ø² Ø¯ÛŒØ¬ÛŒâ€ŒÚ©Ø§Ù„Ø§) Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù…Ù‚Ø§ÛŒØ³Ù‡ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>
            <input type="text" id="compare-products-input-1" class="form-input" placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„ Ø§ÙˆÙ„">
            <input type="text" id="compare-products-input-2" class="form-input" placeholder="Ù†Ø§Ù… Ù…Ø­ØµÙˆÙ„ Ø¯ÙˆÙ…">
            <button class="submit-button" onclick="handleCompareProducts()">Ù…Ù‚Ø§ÛŒØ³Ù‡ Ú©Ù†</button>
            <div id="compare-products-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
        
        <div id="page-create-article" class="page">
            <h2>ğŸ“° Ø³Ø§Ø®Øª Ù…Ù‚Ø§Ù„Ù‡</h2>
            <p class="description">Ù…ÙˆØ¶ÙˆØ¹ Ù…Ù‚Ø§Ù„Ù‡ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>
            <input type="text" id="create-article-input" class="form-input" placeholder="Ù…Ø«Ø§Ù„: ØªØ§Ø«ÛŒØ± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø± Ø§Ø´ØªØºØ§Ù„">
            <button class="submit-button" onclick="handleTextSubmit('create-article')">Ù…Ù‚Ø§Ù„Ù‡ Ø¨Ø³Ø§Ø²</button>
            <div id="create-article-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
        
        <div id="page-image-info" class="page">
            <h2>â„¹ï¸ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ú©Ø³</h2>
            <p class="description">Ø¹Ú©Ø³ÛŒ Ø±Ø§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯ ØªØ§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ù† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´ÙˆØ¯.</p>
            <input type="file" id="image-info-input" class="form-input" accept="image/*">
            <button class="submit-button" onclick="handleImageUpload('image-info')">Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª</button>
            <div id="image-info-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>

        <div id="page-enhance-image" class="page">
            <h2>ğŸŒ„ Ø§ÙØ²Ø§ÛŒØ´ Ú©ÛŒÙÛŒØª Ø¹Ú©Ø³</h2>
            <p class="description">Ø¹Ú©Ø³ Ø¨ÛŒâ€ŒÚ©ÛŒÙÛŒØª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø¨Ù‡Ø¨ÙˆØ¯ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.</p>
            <input type="file" id="enhance-image-input" class="form-input" accept="image/*">
            <button class="submit-button" onclick="handleImageUpload('enhance-image')">Ø§Ø±Ø³Ø§Ù„</button>
            <div id="enhance-image-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
        
        <div id="page-ghibli" class="page">
            <h2>ğŸ‘ ØªØ¨Ø¯ÛŒÙ„ Ø¹Ú©Ø³</h2>
            <p class="description">Ø¹Ú©Ø³ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ Ø³Ø¨Ú© Ù‡Ù†Ø±ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.</p>
            <input type="file" id="ghibli-input" class="form-input" accept="image/*">
            <button class="submit-button" onclick="handleImageUpload('ghibli')">ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†</button>
            <div id="ghibli-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>

        <div id="page-create-image" class="page">
            <h2>âœ¨ Ø³Ø§Ø®Øª Ø¹Ú©Ø³</h2>
            <p class="description">ØªÙˆØ¶ÛŒØ­Ø§Øª Ø¹Ú©Ø³ Ø±Ø§ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯.</p>
            <textarea id="create-image-input" class="form-textarea" rows="3" placeholder="e.g., a cute cat astronaut on Mars, digital art"></textarea>
            <button class="submit-button" onclick="handleTextSubmit('create-image')">Ø¹Ú©Ø³ Ø¨Ø³Ø§Ø²</button>
            <div id="create-image-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>

        <div id="page-translate" class="page">
            <h2>ğŸŒ ØªØ±Ø¬Ù…Ù‡ Ù…ØªÙ†</h2>
            <p class="description">Ù…ØªÙ† Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø±Ø§ÛŒ ØªØ±Ø¬Ù…Ù‡ Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>
            <textarea id="translate-input" class="form-textarea" rows="5" placeholder="Ù…ØªÙ† Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."></textarea>
            <button class="submit-button" onclick="handleTextSubmit('translate')">ØªØ±Ø¬Ù…Ù‡ Ú©Ù†</button>
            <div id="translate-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>

        <div id="page-currency" class="page">
            <h2>ğŸ’¹ Ø¢Ø®Ø±ÛŒÙ† Ù†Ø±Ø® Ø§Ø±Ø² Ùˆ Ø·Ù„Ø§</h2>
            <div id="currency-content" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>

        <div id="page-advanced-search" class="page">
            <h2>ğŸ” Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h2>
            <p class="description">Ø¯Ø± Ù…Ø­ØªÙˆØ§ÛŒ ÛŒÚ© Ú©Ø§Ù†Ø§Ù„ Ø¹Ù…ÙˆÙ…ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… Ø¬Ø³ØªØ¬ÙˆÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.</p>
            <input type="text" id="advanced-search-channel-input" class="form-input" placeholder="ÛŒÙˆØ²Ø±Ù†ÛŒÙ… ÛŒØ§ Ù„ÛŒÙ†Ú© Ú©Ø§Ù†Ø§Ù„ (e.g., @OpenAI)">
            <input type="text" id="advanced-search-query-input" class="form-input" placeholder="Ø¹Ø¨Ø§Ø±Øª Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø¨Ø±Ø§ÛŒ Ø¬Ø³ØªØ¬Ùˆ">
            <button class="submit-button" onclick="handleAdvancedSearch()">Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†</button>
            <div id="advanced-search-result" class="result-box"></div>
            <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
        
        <div id="page-help" class="page">
             <h2>ğŸ’â€â™‚ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§</h2>
             <div class="text-sm space-y-3 result-box">
                <p>Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
                <p>Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡Ø± Ù‚Ø§Ø¨Ù„ÛŒØªØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ú©Ù„ÛŒÚ© Ú©Ø±Ø¯Ù‡ Ùˆ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„â€ŒÙ‡Ø§ÛŒ Ø¢Ù† ØµÙØ­Ù‡ Ø±Ø§ Ø¯Ù†Ø¨Ø§Ù„ Ú©Ù†ÛŒØ¯.</p>
                <p>Ø¨Ø±Ø§ÛŒ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø§Ø±Ø³Ø§Ù„ ÙØ§ÛŒÙ„ Ø¯Ø§Ø±Ù†Ø¯ (Ù…Ø§Ù†Ù†Ø¯ Ø­Ø°Ù Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡)ØŒ Ù¾Ø³ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ "Ø§Ø±Ø³Ø§Ù„" Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯.</p>
             </div>
             <button onclick="goBack()" class="back-button">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.BackButton.onClick(goBack);

        const API_BASE_URL = 'https://Ai.iropt-k.ir'; // IP Ø³Ø±ÙˆØ± Ø´Ù…Ø§

        // --- NAVIGATION LOGIC ---
        function showPage(pageId) {
            tg.HapticFeedback.impactOccurred('light');
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            const newPage = document.getElementById(pageId);
            newPage.classList.add('active');
            
            if (pageId !== 'page-main-menu') {
                tg.BackButton.show();
            }

            if (pageId === 'page-currency') fetchCurrencyRates();
        }

        function goBack() {
            showPage('page-main-menu');
            tg.BackButton.hide();
        }

        // --- HANDLER FUNCTIONS ---
        function sendData(command) {
            tg.HapticFeedback.impactOccurred('light');
            tg.sendData(command);
            tg.close();
        }
        
        async function apiCall(endpoint, options) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/${endpoint}`, options);
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({error: "Ø®Ø·Ø§ÛŒ Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡ Ø¯Ø± Ø³Ø±ÙˆØ±"}));
                    throw new Error(errorData.error);
                }
                return await response.json();
            } catch (error) {
                console.error('API Call Error:', error);
                throw new Error(error.message || 'ÛŒÚ© Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ Ø¨Ø§ Ø³Ø±ÙˆØ± Ø±Ø® Ø¯Ø§Ø¯.');
            }
        }
        
        async function handleImageUpload(type) {
            const input = document.getElementById(`${type}-input`);
            const resultDiv = document.getElementById(`${type}-result`);
            if (!input.files || input.files.length === 0) {
                resultDiv.innerHTML = '<p class="text-red-500">Ù„Ø·ÙØ§ Ø§Ø¨ØªØ¯Ø§ ÛŒÚ© ÙØ§ÛŒÙ„ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.</p>';
                return;
            }
            const file = input.files[0];
            const formData = new FormData();
            formData.append('image', file);
            
            resultDiv.innerHTML = '<div class="loader">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±...</div>';
            try {
                const result = await apiCall(type, { method: 'POST', body: formData });
                resultDiv.innerHTML = result.text ? `<p>${result.text}</p>` : `<img src="${result.imageUrl}" alt="Processed Image" class="result-image">`;
            } catch (error) {
                resultDiv.innerHTML = `<p class="text-red-500">Ø®Ø·Ø§: ${error.message}</p>`;
            }
        }
        
        async function handleTextSubmit(type) {
            const input = document.getElementById(`${type}-input`);
            const resultDiv = document.getElementById(`${type}-result`);
            if (!input.value.trim()) {
                resultDiv.innerHTML = '<p class="text-red-500">Ù„Ø·ÙØ§ ÙÛŒÙ„Ø¯ ÙˆØ±ÙˆØ¯ÛŒ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯.</p>';
                return;
            }
            
            resultDiv.innerHTML = '<div class="loader">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¯Ø±Ø®ÙˆØ§Ø³Øª...</div>';
            try {
                const result = await apiCall(type, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: input.value })
                });
                resultDiv.innerHTML = result.imageUrl ? `<img src="${result.imageUrl}" alt="Generated Image" class="result-image">` : `<p>${result.text}</p>`;
            } catch (error) {
                resultDiv.innerHTML = `<p class="text-red-500">Ø®Ø·Ø§: ${error.message}</p>`;
            }
        }

        async function handleCompareProducts() {
            const input1 = document.getElementById('compare-products-input-1');
            const input2 = document.getElementById('compare-products-input-2');
            const resultDiv = document.getElementById('compare-products-result');
            if (!input1.value.trim() || !input2.value.trim()) {
                resultDiv.innerHTML = '<p class="text-red-500">Ù„Ø·ÙØ§ Ù†Ø§Ù… Ù‡Ø± Ø¯Ùˆ Ù…Ø­ØµÙˆÙ„ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>';
                return;
            }
            resultDiv.innerHTML = '<div class="loader">Ø¯Ø± Ø­Ø§Ù„ Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª...</div>';
            try {
                 const result = await apiCall('compare-products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ product1: input1.value, product2: input2.value })
                });
                 resultDiv.innerHTML = `<p>${result.text}</p>`;
            } catch (error) {
                resultDiv.innerHTML = `<p class="text-red-500">Ø®Ø·Ø§: ${error.message}</p>`;
            }
        }
        
        async function handleAdvancedSearch() {
            const channelInput = document.getElementById('advanced-search-channel-input');
            const queryInput = document.getElementById('advanced-search-query-input');
            const resultDiv = document.getElementById('advanced-search-result');
            if (!channelInput.value.trim() || !queryInput.value.trim()) {
                resultDiv.innerHTML = '<p class="text-red-500">Ù„Ø·ÙØ§ Ù‡Ù… Ù„ÛŒÙ†Ú© Ú©Ø§Ù†Ø§Ù„ Ùˆ Ù‡Ù… Ø¹Ø¨Ø§Ø±Øª Ø¬Ø³ØªØ¬Ùˆ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.</p>';
                return;
            }
            resultDiv.innerHTML = '<div class="loader">Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ú©Ø§Ù†Ø§Ù„... (Ø§ÛŒÙ† Ú©Ø§Ø± Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø·ÙˆÙ„Ø§Ù†ÛŒ Ø´ÙˆØ¯)</div>';
            try {
                 const result = await apiCall('advanced-search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ channel: channelInput.value, query: queryInput.value })
                });
                 resultDiv.innerHTML = `<p>${result.text}</p>`;
            } catch (error) {
                resultDiv.innerHTML = `<p class="text-red-500">Ø®Ø·Ø§: ${error.message}</p>`;
            }
        }

        async function fetchCurrencyRates() {
            const contentDiv = document.getElementById('currency-content');
            contentDiv.innerHTML = '<div class="loader">Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª...</div>';
            try {
                const data = await apiCall('currency', {});
                contentDiv.innerHTML = `
                    <p><strong>Ù‡Ø± Ú¯Ø±Ù… Ø·Ù„Ø§ÛŒ 18:</strong> ${data.gold.geram18 || 'N/A'} Ø±ÛŒØ§Ù„</p>
                    <p><strong>Ø³Ú©Ù‡ Ø§Ù…Ø§Ù…ÛŒ:</strong> ${data.gold.sekee || 'N/A'} Ø±ÛŒØ§Ù„</p>
                    <hr class="border-gray-600 my-2">
                    <p><strong>Ø¯Ù„Ø§Ø± Ø¢Ù…Ø±ÛŒÚ©Ø§:</strong> ${data.fiat.usd || 'N/A'} Ø±ÛŒØ§Ù„</p>
                    <p><strong>ÛŒÙˆØ±Ùˆ Ø§Ø±ÙˆÙ¾Ø§:</strong> ${data.fiat.eur || 'N/A'} Ø±ÛŒØ§Ù„</p>
                `;
            } catch (error) {
                contentDiv.innerHTML = `<p class="text-red-500">Ø®Ø·Ø§: ${error.message}</p>`;
            }
        }

        // Hide Telegram's back button on the main menu initially
        tg.BackButton.hide();
    </script>
</body>
</html>
